context("polygon")


test_that("add_polygon accepts multiple objects", {

	geo <- '[{"type":"Feature","properties":{"elevation":0,"fill_colour":"#440154FF","stroke_colour":"#440154FF"},"geometry":{"geometry":{"type":"Polygon","coordinates":[[[143.704768,-37.519353],[143.704821,-37.518987],[143.705575,-37.515014],[143.706168,-37.511889],[143.70626,-37.511442],[143.709359,-37.512849],[143.709858,-37.513075],[143.715045,-37.514603],[143.728322,-37.518476],[143.729533,-37.518828],[143.731409,-37.519625],[143.741582,-37.523941],[143.744658,-37.507246],[143.744837,-37.50733],[143.746982,-37.508431],[143.759412,-37.514044],[143.759625,-37.514162],[143.7617,-37.515111],[143.7692,-37.518496],[143.78144699999999,-37.524028],[143.802865,-37.533703],[143.802105,-37.537777],[143.800909,-37.539903],[143.802616,-37.540109],[143.812338,-37.541365],[143.811262,-37.542158],[143.811061,-37.542343],[143.810757,-37.542681],[143.810521,-37.543014],[143.810269,-37.543486],[143.810145,-37.543813],[143.810041,-37.544209],[143.809943,-37.544697],[143.809839,-37.545272],[143.809593,-37.546618],[143.81331,-37.547066],[143.813226,-37.547506],[143.814561,-37.547668],[143.813905,-37.551102],[143.813536,-37.553099],[143.813492,-37.553412],[143.81487,-37.554022],[143.816439,-37.554716],[143.818958,-37.555832],[143.81885,-37.555959],[143.818638,-37.556354],[143.818568,-37.556499],[143.818533,-37.556805],[143.818489,-37.557147],[143.818272,-37.558161],[143.818181,-37.559006],[143.817871,-37.560662],[143.817818,-37.561006],[143.817491,-37.562842],[143.817115,-37.564764],[143.816976,-37.565453],[143.816949,-37.565651],[143.816709,-37.56677],[143.816213,-37.568618],[143.816173,-37.568888],[143.815871,-37.570439],[143.810498,-37.569812],[143.810402,-37.569898],[143.801002,-37.56879],[143.794272,-37.568003],[143.782987,-37.566688],[143.782815,-37.566671],[143.755572,-37.56348],[143.748011,-37.562609],[143.738198,-37.561472],[143.715638,-37.558854],[143.707238,-37.557878],[143.693674,-37.558222],[143.692926,-37.558274],[143.692307,-37.558405],[143.685929,-37.56013],[143.684946,-37.551536],[143.686941,-37.540707],[143.686998,-37.540466],[143.688855,-37.530731],[143.689259,-37.530783],[143.690048,-37.526354],[143.690823,-37.521999],[143.690835,-37.521911],[143.691945,-37.522037],[143.691959,-37.521947],[143.692952,-37.51635],[143.692967,-37.516261],[143.703651,-37.51758],[143.703973,-37.517609],[143.70445,-37.518707],[143.704666,-37.519108],[143.704768,-37.519353]]]}}}]'
	poly <- '[{"elevation":0,"fill_colour":"#440154FF","stroke_colour":"#440154FF","polyline":["|~~cFwiblZiAKyWuCqRuBwAQvGkRl@cBpHm_@dW_rAdAqF~CuJ~Ys~@kgBeRPc@zEmL`b@ulAVi@|D}KbT}m@pa@okAn{@{dClXvChLnFf@uIzFw{@|CtEd@f@bA|@`Al@|Ar@`AVlAR`BRrBTjGn@xAgVvAP^kGnTbClKhA~@FxBsGhCwH~EwNVRnAj@ZL|@DbAHjEh@fDPjI|@bAJnJ~@~JjAhCZf@D~En@nJ`Bt@FtHz@{Br`@NP{Evy@}C`i@gGpeAA`@}RfiDoDfn@aFj|@kO~kCcEns@dAvsAHtCXzBxIzf@wt@bEubAoKo@Iy{@sJHoAuZ}CgZ{COAV}EQA}a@gEQAfGyaAB_AzE_BnAi@p@S"]}]'

	## sf
	set_token("abc")
	m <- mapdeck()

	sf <- spatialwidget::melbourne[1, ]
	p <- add_polygon(map = m, data = sf)
	expect_equal( as.character( p$x$calls[[1]]$args[[1]] ), geo )

	## sfencoded
	enc <- googlePolylines::encode( sf )
	p <- add_polygon( map = m, data = enc )
	expect_equal( as.character( p$x$calls[[1]]$args[[1]] ), poly )

	## sfencodedLite
	enc <- googlePolylines::encode( sf, strip = T )
	p <- add_polygon( map = m, data = enc )
	expect_equal( as.character( p$x$calls[[1]]$args[[1]] ), poly )

	## data.frame with polyline
	df <- as.data.frame( enc )
	df$geometry <- df$geometry

	p <- add_polygon( map = m, data = df, polyline = "geometry" )
	expect_equal( as.character( p$x$calls[[1]]$args[[1]] ), poly )

})
